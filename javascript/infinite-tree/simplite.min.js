var Simplite=function(){var a={},b=function(a){var b=Object.prototype.toString;return function(c){return b.call(c)==="[object "+a+"]"}},c=b("String"),e=(b("Array"),function(a){return c(a)?document.getElementById(a):a.nodeName?a:a[0]}),f=function(a){var b=e(a);return b?b.innerHTML:a},g=function(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"},h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","\\":"\\\\",'"':'\\"'},i=function(a){return"undefined"==typeof a?"":"string"!=typeof a?a:a.replace(/\\|\"|&|<|>|"|'/g,function(a){return h[a]})},j=function(a,b){return a.split(b)},k=function(a,b){return a.split(b)},l=function(){return u.attrOpenTag===u.logicOpenTag&&u.attrCloseTag===u.logicCloseTag},m=function(a,b){var c="";return a&&(c+=0===a.indexOf("#")?"out += Simplite.escapeHTML("+a.substr(1)+");":"out += "+a+";"),b&&(c+="out += "+g(b)+";"),c},n=function(a,b){var c="";return a&&(a=a.replace(/(\W)?(include\s*\(([^\)]+)\))/g,function(a,b,c,d){return d.indexOf(",")<0&&(d+=",_this"),(b||"")+"out += Simplite.include("+d+")"}),/[^\{;]\s*$/.test(a)&&(a+="\n"),l()&&/^=\s*(.)/.test(a)&&(a="#"===RegExp.$1?"out += Simplite.escapeHTML("+a.substr(2)+");":"out += "+a.substr(1)+";"),c+=a),b&&(c+=l()?"out += "+g(b)+";":o(b,u.attrOpenTag,u.attrCloseTag,m)),c},o=function(a,b,c,d){for(var e="",f=j(a,b),g=0,h=f.length;h>g;g++){var i=f[g],l=k(i,c),m=l[0],n=l[1];void 0===n&&(n=m,m=""),e+=d(m,n)}return e},p=function(a){return'var out = "";'+o(a,u.logicOpenTag,u.logicCloseTag,n)},q=function(b){var c=a[b];if(!c){var d=p(b);c=a[b]=new Function("obj","with (obj) {var _this = obj;"+d+"; return out;}")}return c},r=function(a,b){return a=f(a),s(a,b)},s=function(a,b){return q(a)(b)},t=function(a,b,c){a=e(a),a.innerHTML=b,c&&c(a)},u=function(a){this.target=e(a.target),this.template=f(a.template)};return u.prototype.compile=function(){return q(this.template)},u.prototype.render=function(a){this.beforerender(a),t(this.target,s(this.template,a),this.afterrender)},u.prototype.beforerender=function(a){},u.prototype.afterrender=function(a){},u.logicOpenTag="<%",u.logicCloseTag="%>",u.attrOpenTag="<%",u.attrCloseTag="%>",u.escapeHTML=i,u.getTemplate=f,u.include=r,u.compile=q,u.toHtml=s,u.render=t,u}();